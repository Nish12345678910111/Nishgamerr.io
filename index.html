<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern Chat</title>
<style>
  body {
    background:#111; color:#fff; font-family:sans-serif;
    display:flex; flex-direction:column; align-items:center;
    margin:0; height:100vh;
  }
  h2 {margin:10px; font-size:20px;}
  #chatBox {
    flex:1; width:95%; max-width:500px; overflow-y:auto;
    border:1px solid #333; border-radius:8px;
    background:#1b1b1b; padding:10px; margin-bottom:10px;
  }
  .msg {
    margin:5px 0; padding:6px 8px; border-radius:8px;
    background:#222; position:relative;
  }
  .msg span {display:block; font-size:12px; color:#aaa;}
  .delBtn {
    position:absolute; top:5px; right:5px;
    width:15px; height:15px; border:none; border-radius:3px;
    background:#900; color:#fff; cursor:pointer; font-size:10px;
  }
  #inputBox {display:flex; width:95%; max-width:500px; gap:5px;}
  input, button {
    padding:8px; border:none; border-radius:6px; outline:none;
  }
  input {flex:1;}
  button {background:#444; color:#fff; cursor:pointer;}
  button:hover {background:#666;}
  #autoScrollToggle {
    position:fixed; bottom:10px; right:10px;
    background:#333; border:none; color:#fff;
    border-radius:6px; padding:6px 10px; cursor:pointer;
  }
</style>
</head>
<body>
<h2>Modern Chat</h2>
<div id="chatBox"></div>

<div id="inputBox">
  <input id="msgInput" placeholder="Type message...">
  <button onclick="sendMsg()">Send</button>
  <button onclick="deleteAllMine()">Del All Mine</button>
</div>

<button id="autoScrollToggle" onclick="toggleAutoScroll()">AutoScroll: ON</button>

<script>
let messages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
let username = localStorage.getItem("username") || prompt("Enter your username:");
if (!username) username = "Guest"+Math.floor(Math.random()*1000);
localStorage.setItem("username", username);

let autoScroll = true;

function saveMessages() {
  localStorage.setItem("chatMessages", JSON.stringify(messages));
}

function renderChat() {
  const chatBox = document.getElementById("chatBox");
  chatBox.innerHTML = "";
  for (const m of messages) {
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `<b>${m.user}</b>: ${m.text}
      <span>${m.time}</span>`;
    if (m.user === username) {
      const del = document.createElement("button");
      del.className = "delBtn";
      del.textContent = "Ã—";
      del.onclick = () => deleteMsg(m.id);
      div.appendChild(del);
    }
    chatBox.appendChild(div);
  }
  if (autoScroll) chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMsg() {
  const input = document.getElementById("msgInput");
  const text = input.value.trim();
  if (!text) return;
  const now = new Date();
  const msg = {
    id: Date.now(),
    user: username,
    text,
    time: now.toLocaleString()
  };
  messages.push(msg);
  saveMessages();
  input.value = "";
  renderChat();
}

function deleteMsg(id) {
  messages = messages.filter(m => m.id !== id || m.user !== username);
  saveMessages();
  renderChat();
}

function deleteAllMine() {
  if (!confirm("Delete all your messages?")) return;
  messages = messages.filter(m => m.user !== username);
  saveMessages();
  renderChat();
  alert("All your messages deleted.");
}

function toggleAutoScroll() {
  autoScroll = !autoScroll;
  document.getElementById("autoScrollToggle").textContent =
    "AutoScroll: " + (autoScroll ? "ON" : "OFF");
}

function refreshChat() {
  messages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
  renderChat();
}

renderChat();
setInterval(refreshChat, 1000);
</script>
</body>
</html>
